<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jack’s Timetable</title>
<style>
  :root{
    --bg:#0d1117; --panel:#111827; --muted:#8b95a7; --text:#e5e7eb;
    --accent:#38bdf8; --accent-2:#60a5fa; --good:#34d399; --warn:#f59e0b;
    --today:#1f2937; --period:#0b2a3b; --grid:#1f2633;
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#0b1220, #0b1324 30%, #0b1220);
    color:var(--text); font:500 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    display:flex; align-items:stretch; justify-content:center; padding:18px;
  }
  .wrap{max-width:1100px; width:100%; display:flex; flex-direction:column; gap:14px}
  header{
    display:grid; gap:10px; align-items:center;
    grid-template-columns: 1fr auto auto auto;
    background:rgba(17,24,39,.65); backdrop-filter:saturate(1.2) blur(6px);
    border:1px solid #1e293b; border-radius:var(--radius); padding:14px 16px;
  }
  h1{margin:0; font-size:20px; letter-spacing:.2px}
  .pill{display:inline-flex; gap:10px; align-items:center; background:#0b1220; border:1px solid #1e293b; border-radius:999px; padding:8px 12px; color:var(--muted)}
  .pill strong{color:var(--text)}
  .controls{display:flex; gap:8px; flex-wrap:wrap}
  button, select, input[type="time"], input[type="date"]{
    background:#0b1220; color:var(--text); border:1px solid #1f2937; border-radius:10px; padding:8px 10px; font-weight:600
  }
  button:hover{border-color:#334155}
  button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#06131b; border-color:transparent}
  .grid{
    background:var(--panel); border:1px solid #1f2937; border-radius:var(--radius); overflow:hidden;
  }
  .tt{
    display:grid;
    grid-template-columns: 120px repeat(5, 1fr);
    /* header row + 7 period rows by default (1,2,3,4a,4b,5,6) */
  }
  .tt > div{border-bottom:1px solid var(--grid); border-right:1px solid var(--grid); padding:10px 10px; min-height:64px}
  .tt > div:last-child{border-right:none}
  .tt .head{background:#0b1220; position:sticky; top:0; z-index:2; font-weight:800; color:#cbd5e1}
  .tt .time{background:#0b1220; font-weight:700; color:#a9b4c6}
  .tt .today-col.head{background:linear-gradient(180deg,#0b1220 0%, #111b2a 120%)}
  .tt .today-col:not(.head){background:linear-gradient(180deg,var(--today), #0e1726)}
  .cell{
    width:100%; height:100%; outline:none; border:none; background:transparent; color:var(--text);
    font:600 14px/1.2 ui-sans-serif, system-ui; resize:none; overflow:hidden;
  }
  .cell::placeholder{color:#6b7280}
  .period-now{box-shadow:inset 0 0 0 2px var(--accent); background:linear-gradient(180deg,#0b1220, var(--period) 160%)}
  .legend{display:flex; gap:14px; color:var(--muted); font-size:14px; padding:0 6px 2px 6px}
  .legend span{display:inline-flex; align-items:center; gap:6px}
  .dot{width:10px; height:10px; border-radius:50%}
  .dot.today{background:var(--accent-2)}
  .dot.now{background:var(--accent)}
  footer{color:#92a0b1; font-size:12px; text-align:center; padding:6px}
  .hint{color:#93c5fd; font-weight:700}
  @media (max-width:820px){
    .tt{grid-template-columns: 86px repeat(5, minmax(120px,1fr))}
    .tt > div{min-height:72px}
  }
</style>
</head>
<body>
<div class="wrap">

  <header>
    <h1>Jack’s 2-Week Timetable</h1>

    <div class="pill">
      <span>Week:</span>
      <strong id="weekLabel">A</strong>
      <span>•</span>
      <span id="todayLabel">ThuA</span>
    </div>

    <div class="controls">
      <button id="prevDay">◀</button>
      <input id="datePick" type="date" />
      <button id="nextDay">▶</button>
    </div>

    <div class="controls">
      <button id="todayBtn" class="primary">Today</button>
      <button id="toggleWeek">Toggle A/B</button>
    </div>
  </header>

  <div class="legend">
    <span><span class="dot today"></span> Today’s column</span>
    <span><span class="dot now"></span> Current period</span>
    <span>Click any cell to edit — autosaves</span>
  </div>

  <div class="grid">
    <div id="table" class="tt" role="table" aria-label="Timetable"></div>
  </div>

  <footer>
    Seeded so that <span class="hint">Thu 4 Sep 2025</span> = <span class="hint">Week A</span> (you said “ThuA today”).
    The week flips every Monday; the A/B cycle updates automatically from that seed.
  </footer>
</div>

<script>
/* =========================
   CONFIG (edit these)
   ========================= */

/** Periods (edit times if your school differs) */
const PERIODS = [
  { id:"1",   label:"1",   start:"08:45", end:"09:45" },
  { id:"2",   label:"2",   start:"09:45", end:"10:45" },
  { id:"3",   label:"3",   start:"11:05", end:"12:05" },   // after break
  { id:"4a",  label:"4a",  start:"12:05", end:"12:35" },   // split lunch
  { id:"4b",  label:"4b",  start:"13:15", end:"13:45" },
  { id:"5",   label:"5",   start:"13:45", end:"14:45" },
  { id:"6",   label:"6",   start:"14:45", end:"15:45" },
];

/** Known seed: Thu 2025-09-04 is Week A (per your note “today it’s ThuA”). */
const SEED_ISO = "2025-09-04";    // change if needed
const SEED_IS_WEEK_A = true;

/** Storage key */
const STORE_KEY = "jack_tt_v1";

/** Days used in grid */
const DAYS = ["Mon","Tue","Wed","Thu","Fri"];

/* ============ DATA MODEL ============
   You can pre-fill subjects/rooms/teachers.
   Each cell is free text (supports new lines).
   Structure: data[week]["Mon".."Fri"][periodId] = "text"
*/
const EMPTY_DAY = () => Object.fromEntries(PERIODS.map(p => [p.id, ""]));

const DEFAULT_DATA = {
  A: Object.fromEntries(DAYS.map(d => [d, EMPTY_DAY()])),
  B: Object.fromEntries(DAYS.map(d => [d, EMPTY_DAY()])),
};

/* Example: put a couple you can overwrite in the UI */
DEFAULT_DATA.A.Thu["1"] = "11G/En1 · C7\nMr C A James";
DEFAULT_DATA.A.Thu["2"] = "11G/Pe3 · —\nMr M A Bell";
DEFAULT_DATA.A.Thu["3"] = "11A/Ho1 · G6\nMs E Brown";

/* =========================
   UTILITIES
   ========================= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function parseISO(d){const [y,m,day]=d.split("-").map(Number); return new Date(y, m-1, day);}
function fmtISO(d){return d.toISOString().slice(0,10);}
function startOfWeekMonday(d){
  const x = new Date(d); const dow = (x.getDay()+6)%7; // 0=Mon
  x.setDate(x.getDate() - dow); x.setHours(0,0,0,0); return x;
}
function weekDiff(a,b){ // whole weeks between Mondays
  const am = startOfWeekMonday(a), bm = startOfWeekMonday(b);
  return Math.round((am - bm) / (7*24*60*60*1000));
}
function getWeekForDate(date){
  const seed = parseISO(SEED_ISO);
  const diff = weekDiff(date, seed);
  const sameParity = (Math.abs(diff) % 2) === 0;
  return (SEED_IS_WEEK_A ? (sameParity ? "A" : "B") : (sameParity ? "B" : "A"));
}
function dowLabel(d){ return ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()]; }

function timeToMinutes(t){ const [h,m] = t.split(":").map(Number); return h*60 + m; }
function nowMinutes(date){ return date.getHours()*60 + date.getMinutes(); }

/* =========================
   STATE
   ========================= */
let state = {
  date: new Date(),          // the date you’re viewing
  week: "A",                 // gets derived from date but can be toggled
  data: load() ?? DEFAULT_DATA
};

function load(){
  try{ const raw = localStorage.getItem(STORE_KEY); return raw ? JSON.parse(raw) : null; }
  catch(e){ console.warn("Storage load failed", e); return null; }
}
function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(state.data)); }

/* =========================
   RENDER
   ========================= */
function render(){
  // derive week from selected date (unless user toggled explicitly)
  const computedWeek = getWeekForDate(state.date);
  state.week = computedWeek;

  const week = state.week;
  const dayKey = dowLabel(state.date).slice(0,3); // Mon/Tue...

  // Header labels
  $("#weekLabel").textContent = week;
  $("#todayLabel").textContent = `${dayKey}${week}`;
  $("#datePick").value = fmtISO(state.date);

  // Build grid
  const table = $("#table");
  table.innerHTML = "";

  // Header row
  addCell("Time", "head time");
  DAYS.forEach(d=>{
    const cls = (d === dayKey) ? "head today-col" : "head";
    addCell(d, cls);
  });

  // Period rows
  const currentMin = nowMinutes(new Date());
  const isTodayColumn = (d) => d === dayKey && fmtISO(state.date) === fmtISO(new Date());

  PERIODS.forEach((p)=>{
    // left time column
    const tCell = document.createElement("div");
    tCell.className = "time";
    tCell.innerHTML = `<div style="font-weight:800">${p.label}</div>
                       <div style="color:var(--muted); font-weight:600">${p.start}–${p.end}</div>`;
    table.appendChild(tCell);

    // day columns
    DAYS.forEach((d)=>{
      const wrapper = document.createElement("div");
      if(d===dayKey) wrapper.classList.add("today-col");

      const ta = document.createElement("textarea");
      ta.className = "cell";
      ta.placeholder = "Subject · Room\nTeacher";
      ta.value = (state.data?.[week]?.[d]?.[p.id]) ?? "";

      // mark current period (live) if on *today*
      if(isTodayColumn(d)){
        const nm = nowMinutes(new Date());
        const inNow = nm >= timeToMinutes(p.start) && nm < timeToMinutes(p.end);
        if(inNow) wrapper.classList.add("period-now");
      }

      // autosize textarea
      const autoSize = (el)=>{ el.style.height="0px"; el.style.height = (el.scrollHeight+2)+"px"; };
      ta.addEventListener("input", ()=>autoSize(ta));
      setTimeout(()=>autoSize(ta), 0);

      // save on blur / input (debounced)
      let tmr;
      const persist = ()=>{
        state.data[week] ??= {};
        state.data[week][d] ??= {};
        state.data[week][d][p.id] = ta.value;
        save();
      };
      ta.addEventListener("input", ()=>{ clearTimeout(tmr); tmr=setTimeout(persist, 250); });
      ta.addEventListener("blur", persist);

      wrapper.appendChild(ta);
      table.appendChild(wrapper);
    });
  });

  function addCell(text, cls=""){
    const el = document.createElement("div");
    el.className = cls; el.textContent = text;
    table.appendChild(el);
  }
}

/* =========================
   NAV / CONTROLS
   ========================= */
$("#todayBtn").addEventListener("click", ()=>{
  state.date = new Date(); render();
});
$("#prevDay").addEventListener("click", ()=>{
  const d = new Date(state.date); d.setDate(d.getDate()-1); state.date = d; render();
});
$("#nextDay").addEventListener("click", ()=>{
  const d = new Date(state.date); d.setDate(d.getDate()+1); state.date = d; render();
});
$("#datePick").addEventListener("change", (e)=>{
  state.date = parseISO(e.target.value); render();
});

// Manual A/B toggle (kept for convenience): it flips the seed reference one week
$("#toggleWeek").addEventListener("click", ()=>{
  // Move the shown date by +7 or -7 days to flip week while keeping same weekday
  const d = new Date(state.date);
  d.setDate(d.getDate()+7);
  state.date = d;
  render();
});

// live re-highlight current period every minute
setInterval(()=>{
  if(fmtISO(state.date) !== fmtISO(new Date())) return; // only when viewing today
  render();
}, 60000);

/* =========================
   START
   ========================= */
(function init(){
  // If *today* is ThuA per your message, ensure our initial date shows today.
  // (We already seeded the calendar logic with 2025-09-04 = A.)
  render();
})();
</script>
</body>
</html>
